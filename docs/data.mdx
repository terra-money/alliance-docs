---
sidebar_position: 8
---
# Data Structures

The Alliance module’s data structures are defined using the [Protocol Buffer language](https://developers.google.com/protocol-buffers/docs/proto3). These data structures can be found under the [proto/alliance folder](https://github.com/terra-money/alliance/tree/main/proto/alliance) in the module’s code repository.

The following proto files refer to CosmosSDK standards:

- **[genesis.proto](https://github.com/terra-money/alliance/blob/main/proto/alliance/genesis.proto)**: contains the data structure allowed by the module in the genesis file,
- **[params.proto](https://github.com/terra-money/alliance/blob/main/proto/alliance/params.proto)**: data structures related to module parameters,
- **[query.proto](https://github.com/terra-money/alliance/blob/main/proto/alliance/query.proto)**: data structures for the query entry points,
- **[tx.proto](https://github.com/terra-money/alliance/blob/main/proto/alliance/tx.proto): data structures for transaction entry points.**

The [alliance.proto](https://github.com/terra-money/alliance/blob/main/proto/alliance/alliance.proto) and [delegations.proto](https://github.com/terra-money/alliance/blob/main/proto/alliance/delegations.proto) files contain the Alliance module’s internally-used structures.

### 2.4.1 Delegation and Validator Shares

In order to reduce the cost of updating delegation and validator ownership of staked coins whenever we perform slashing and `TakeRate` deductions, the concept of shares is used. Similar to the shares implementation of the Cosmos `x/staking` module, shares are used to keep track of validator assets as proportions of a whole, rather than individual coin balances per account.

Conversions between coins and shares use the following formula:

$$ New Shares = \cfrac{New coins * total validator shares}{total coins}$$

[https://lh5.googleusercontent.com/hGS-g_XP3jhwIe1vhVrLHnMu9IPbfXzDcWCrKzwm2hDlj5Fv8kQ-4Mbfv_Sr66UwPeyyodZ9RJMtHdwqyBAXQngvaXIVZnO6TSy2Ol-b23LKZNTWgnwO9sLXTNZGuMYd_4JOvrY1wwX4Y9_7U70LeOFOnKUcde6PTTZg_vMS7_tUrS37smzNr3dTiVlAxw](https://lh5.googleusercontent.com/hGS-g_XP3jhwIe1vhVrLHnMu9IPbfXzDcWCrKzwm2hDlj5Fv8kQ-4Mbfv_Sr66UwPeyyodZ9RJMtHdwqyBAXQngvaXIVZnO6TSy2Ol-b23LKZNTWgnwO9sLXTNZGuMYd_4JOvrY1wwX4Y9_7U70LeOFOnKUcde6PTTZg_vMS7_tUrS37smzNr3dTiVlAxw)

Whenever coins are deducted after applying the take rate, only `Asset.TotalTokens` needs to be updated. All delegation shares will accordingly claim a smaller pool of coins, effectively reducing the total across all delegations proportionally.

When a validator is slashed, their coin totals are not directly slashed. Instead, the validator’s shares are slashed, causing the offending validator to claim a smaller share of the pool. This effectively distributes the slashed coins proportionally to other non-offending validators.

To calculate the coins staked by a delegator, a two-step formula is used. The first step determines the total coins owned by the validator by multiplying the total amount of coins by the ratio of a validator’s shares over the total number of shares.

$$ total validator coins = \cfrac{validator share * total coins}{total shares}$$

[https://lh6.googleusercontent.com/q-kMjz_UQAvxMk7U0OrGU7wTPtrke0gAl18LrCwNdbfM92X3lcYPIP_5N3NYAL4Il1hhApzMWiaI64UwugBnbBaPZEIP5VmTQg6nDbhZ16m5kMruiC50FM_G9UGLfQQGaqLiCgX4zzW9UtnB0xsXSlRcck9GLr1xzPOT87mpQ3xR4ZKN9fGVGKr3kBjKlg](https://lh6.googleusercontent.com/q-kMjz_UQAvxMk7U0OrGU7wTPtrke0gAl18LrCwNdbfM92X3lcYPIP_5N3NYAL4Il1hhApzMWiaI64UwugBnbBaPZEIP5VmTQg6nDbhZ16m5kMruiC50FM_G9UGLfQQGaqLiCgX4zzW9UtnB0xsXSlRcck9GLr1xzPOT87mpQ3xR4ZKN9fGVGKr3kBjKlg)

To determine the amount of coins a delegator owns, the delegation shares are multiplied by the total validator coins, divided by the total validator shares.

$$ Delegator coins = \cfrac{delegation share * total validator coins}{total validator shares}$$

[https://lh6.googleusercontent.com/vdsj54y9UuM7gouUqfHTuhVUr0oXE3F5Z_CDDFa5TMeXtjFOMErmld49glvfdt0MLxapSKWBjr4c-YTNSp1JgoBWIU_RJ5DmDgVp0SeKQIgcFAhrIF61XVBN1x-XUkRfwejCg4Cn6MZfvgYSouAF2Reu5ScAYlNdT4lwU-v7zsOZp0tIBEm5a8WvU67TNA](https://lh6.googleusercontent.com/vdsj54y9UuM7gouUqfHTuhVUr0oXE3F5Z_CDDFa5TMeXtjFOMErmld49glvfdt0MLxapSKWBjr4c-YTNSp1JgoBWIU_RJ5DmDgVp0SeKQIgcFAhrIF61XVBN1x-XUkRfwejCg4Cn6MZfvgYSouAF2Reu5ScAYlNdT4lwU-v7zsOZp0tIBEm5a8WvU67TNA)

## 3.